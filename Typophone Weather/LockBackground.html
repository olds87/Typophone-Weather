<?xml version="1.0" encoding="utf-8"?>
<!-- 
Design Concept By: Angelman8 [ http://angelman8.deviantart.com/ ] 
Coding By: TooStoned
Edited By: dcinzona
-->
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<script src="jquery.min.js" charset="utf-8"></script>
		<script src="jquery.simpleWeather.min.js" charset="utf-8"></script>
        <script src="functions.js" type="text/javascript"></script>
		<script>
		var zip = '85719';
		var currentZip;
		var cities = [];
		var count = 0;
		var TO;
		function isArray(obj) {
			return (obj.constructor.toString().indexOf("Array") != -1);
		}
		function getLocationFromZip(){
			//get all city locations (will only run if zip is array)
			cities.length = zip.length;
			for(var i = 0; i<zip.length; i++)
			{
				var url = "http://pipes.yahoo.com/pipes/pipe.run?_id=73252b858424ed75a6206333ba8188bc&_render=json&_callback=?&Zipcode=";
				var rurl = url + zip[i];
				$.getJSON(rurl, function(d){
					var item = d.value.items[0];
					var cty = { city: item.Result.City + ', ' + item.Result.State,
					 			zip: item.Result.Zip };
					cities[count] = cty;
					count++;
					listCities();
				});
				   
			}
			$('#timeWrap').click(function(){
				$(this).toggleClass('showSelector');
				var wth = $('#weather');
				wth.toggleClass('showSelector');
				/*if(wth.position().top<290)
					wth.attr('style','-webkit-transform: translateY(15px);');
				else
					wth.attr('style','-webkit-transform: translateY(0px);');*/
					
			});				
		}
		function listCities(){
			if(count==zip.length){
				$('#locationSelector').html('');
				for(var l = 0 ; l<zip.length ; l++){
					for(var y = 0 ; y<count ; y++){
						var cls="location";
						var cty = cities[y];
						if(cty.zip==currentZip){
							cls="location active";
						}
						if(zip[l] == cty.zip)
							$('#locationSelector').append('<span ref="'+cty.zip+'" class="'+cls+'">'+cty.city+"</span>");
					}
				}
				
				var loc = $('.location');
				loc.click(function(){
					var t = $(this);
					t.addClass('active').siblings('span').removeClass('active');
					renderWeather(t.attr('ref'));
				});
				if(cities.length >1)
				{
					$('#locationRight').addClass('visible');
					locationArrows();
				}
			}
		}
		var currentPage = 1;
		function locationArrows()
		{
			var right = $('#locationRight');
			var left = $('#locationLeft');
			var sel = $('#locationSelector');
			right.click(function(){
				left.addClass('visible');
				var pos = sel.position().left;
				if(currentPage<cities.length){
					//slideLeft
					var lft = pos-320;
					sel.attr('style','-webkit-transform: translateX('+lft+'px);');
					currentPage ++;					
				}
				if(currentPage==cities.length){
						right.removeClass('visible');
				}
			});
			left.click(function(){
				var pos = sel.position().left;
				right.addClass('visible');
				if(currentPage>1)
				{
					var lft = pos+320;
					sel.attr('style','-webkit-transform: translateX('+lft+'px);');
					currentPage--;
					if(currentPage==1){
						left.removeClass('visible');
					}
				}
			});
		}
		function renderWeather(z)
		{
			var loader = $('#loader').show();
			currentZip = z;
			if(TO)
				clearTimeout(TO);
			$.simpleWeather({
				zipcode: currentZip,
				unit: 'f',
				success: function(weather) {
					$("#weatherThumb").attr('src', weather.image);
					$("#weatherCity").html(weather.city+', '+weather.region);
					$("#weatherTemp").html(weather.temp+'&deg; '+weather.units.temp);
					$("#weatherCurrently").text(weather.currently);
					$('#weatherCurrently1').text(weather.forecast);
					$('#weatherCurrently2').text(weather.tomorrow.forecast);
					$("#weatherCity1").html('Today');
					$("#weatherCity2").html('Tomorrow');
					$('#weather1High').html('<span class="label">High: </span><span class="bold">'+weather.high +'&deg; </span>'+weather.units.temp);
					$('#weather1Low').html('<span class="label">Low: </span><span class="bold">'+weather.low +'&deg; </span>'+weather.units.temp);
					$('#weather2High').html('<span class="label">High: </span><span class="bold">'+weather.tomorrow.high +'&deg; </span>'+weather.units.temp);
					$('#weather2Low').html('<span class="label">Low: </span><span class="bold">'+weather.tomorrow.low +'&deg; </span>'+weather.units.temp);
					$("#weatherThumb1").attr('src', weather.image);
					$("#weatherThumb2").attr('src', weather.tomorrow.image);
					TO = setTimeout('getWeather()', 600000);
					loader.hide();
				},
				error: function(error) {
					$("#weatherThumb").attr('src', '');//replace with loading
					$("#weatherCity").html('');
					$("#weatherTemp").html('');
					$("#weatherCurrently").text('');
					$('#weatherCurrently1').text('');
					$("#weatherCity1").html('');
					$('#weather1High').html('');
					$('#weather1Low').html('');
					$("#weatherThumb1").attr('');
					$('#weatherCurrently2').text('');
					$("#weatherCity2").html('');
					$('#weather2High').html('');
					$('#weather2Low').html('');
					$("#weatherThumb2").attr('');
					TO = setTimeout('getWeather()',1000);
					loader.hide();
				}
			});
		}
		function getWeather(z){
			if(!isArray(zip)){
					$.get('zip.txt', function(z){
						zip = eval(z);
						if(isArray(zip))
						{
							currentZip = zip[0];
							if(zip.length>1){
								getLocationFromZip();
							}
						}
						else
							currentZip = zip;
						renderWeather(currentZip);
					});
				}
			else
			{
				renderWeather(currentZip);
			}
			
		}
		</script>
        <style type="text/css">@import url("style.css");</style>
    </head>
    <body onload="handle()">
        <base href="Private"/>
		<div id="locationSelectorBG"></div>
		<div id="locationSelector"></div>
		<div id="locationLeft" class="locationArrows"></div>
		<div id="locationRight" class="locationArrows"></div>
		<div id="timeWrap" class="">
            <div id="mainDiv">
                <table id="divtable">
                    <tr>
		                <script type="text/javascript">
		                    document.write('<td><img src="Private/'+getHour(AM_PM).substring(0,1)+'.png" id="hr1" name="hr1"></td>');
		                </script>
				                <script type="text/javascript">
				                    document.write('<td><img src="Private/'+getHour(AM_PM).substring(1,2)+'.png" id="hr2" name="hr2"></td>');
				                </script>
                        <td><img src="Private/NOTamNORpm.png" id="ampm" name="ampm"></td>
					                <script type="text/javascript">
					                    document.write('<td><img src="Private/'+getMinute().substring(0,1)+'.png" id="mn1" name="mn1"></td>');
					                </script>
									<script type="text/javascript">
					                    document.write('<td><img src="Private/'+getMinute().substring(1,2)+'.png" id="mn2" name="mn2"></td>');
					                </script>
                    </tr>
                </table>
            </div>
            <div id="month">
                <script type="text/javascript">
                    document.write("<img width=420 src=Private/"+Month()+".png>");
                </script>
            </div>
            <div id="day">
                <script type="text/javascript">
                    document.write("<img width=250 src=Private/"+Day()+".png>");
                </script>
            </div>
            <div id="dayNumeric">
                <script type="text/javascript"> 
                    document.write("<img width=150 src=Private/"+DayNumeric()+".png>");
                </script> 
            </div>
            <div id="year">
                <script type="text/javascript">
                    document.write("<img width=180 src=Private/"+Year()+".png>");
                </script> 
            </div>
		</div>
			<div id="weather" class="forecast0">
				<div id="Day0Weather" class="weatherSection">
					<img id="weatherThumb" class="weatherThumb"/>
					<h2 id="weatherCity" class="weatherCity" ></h2>
					<div id="weatherTemp" class="weatherTemp" ></div>
					<div id="weatherCurrently" class="weatherCurrently" ></div>
				</div>
				<div id="Day1Weather" class="weatherSection">
					<img id="weatherThumb1" class="weatherThumb" />
					<h2 id="weatherCity1" class="weatherCity" >Today</h2>
					<div id="weatherTemp1" class="weatherTempHighLow" >
						<div id="weather1High"></div>
						<div id="weather1Low"></div>
					</div>
					<div id="weatherCurrently1" class="weatherCurrently" ></div>
				</div>
					<div id="Day2Weather" class="weatherSection">
						<img id="weatherThumb2" class="weatherThumb" />
						<h2 id="weatherCity2" class="weatherCity" >Tomorrow</h2>
						<div id="weatherTemp2" class="weatherTempHighLow" >
							<div id="weather2High"></div>
							<div id="weather2Low"></div>
						</div>
						<div id="weatherCurrently2" class="weatherCurrently" ></div>
					</div>
			</div>
			<script>
			getWeather();
			var currentWeatherShowing = 0;
			$('#weather').click(function(){
				if(currentWeatherShowing>1)
					currentWeatherShowing=0;		
				else	
					currentWeatherShowing++;	
				var t = $(this);
				t.attr('class','forecast'+currentWeatherShowing);
				$('#timeWrap').removeClass('showSelector');
				return false;
			});
			</script>
			<div id="loader"></div>
            <div id="unlock">
                <script type="text/javascript">
                    document.write("<img width=130 src=Private/Unlock.png>");
                </script>
            </div>
    </body>
</html>
